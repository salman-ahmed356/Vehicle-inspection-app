<!-- navbar.html -->

<!-- Tailwind & Font Awesome -->
<script src="https://cdn.tailwindcss.com"></script>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
/>

<div class="bg-blue-500 p-4">
  <div class="container mx-auto flex justify-between items-center">

    <!-- Dashboard and Back Links -->
    <div class="text-white text-lg font-bold flex items-center space-x-4">
      <a href="javascript:history.back()" class="hover:underline flex items-center">
        <i class="fas fa-arrow-left mr-1"></i>
        {{ _('Back') }}
      </a>
      <a href="/dashboard" class="hover:underline flex items-center">
        <i class="fas fa-th-large mr-1"></i>
        {{ _('Dashboard') }}
      </a>
    </div>

    <!-- Main Menu -->
    <div class="flex space-x-8 text-white">
      <!-- Logged in user -->
      {% if session.user_name %}
      <div class="relative group mr-4">
        <i class="fas fa-user-circle text-yellow-300 mr-1"></i>
        <span class="uppercase font-bold text-yellow-200">{{ session.user_name }}</span>
      </div>
      <div class="relative group mr-4">
        <i class="fas fa-sign-out-alt"></i>
        <a href="#" id="logoutBtn" class="hover:underline uppercase">{{ _('Logout') }}</a>
      </div>
      {% endif %}

      <!-- Expertise -->
      <div class="relative group">
        <i class="fas fa-car"></i>
        <a href="{{ url_for('reports.report_list') }}" class="hover:underline uppercase">{{ _('Expertise') }}</a>
        <div class="dropdown-menu">
          <a href="{{ url_for('reports.add_report') }}"
             class="block px-4 py-2 hover:bg-gray-100">
            {{ _('Create New Report') }}
          </a>
          <a href="{{ url_for('reports.report_list') }}"
             class="block px-4 py-2 hover:bg-gray-100">
            {{ _('Open Expertise Reports') }}
          </a>
          <a href="{{ url_for('reports.report_list', status='completed') }}"
             class="block px-4 py-2 hover:bg-gray-100">
            {{ _('Completed Expertise Reports') }}
          </a>
          <a href="{{ url_for('reports.report_list', status='cancelled') }}"
             class="block px-4 py-2 hover:bg-gray-100">
            {{ _('Cancelled Expertise Reports') }}
          </a>
        </div>
      </div>

      <!-- Appointments -->
      <div class="relative group">
        <i class="fas fa-calendar-alt"></i>
        <a href="{{ url_for('appointments.appointment_list') }}"
           class="hover:underline uppercase">{{ _('Appointments') }}</a>
        <div class="dropdown-menu">
          <a href="{{ url_for('appointments.add_appointment') }}"
             class="block px-4 py-2 hover:bg-gray-100">
            {{ _('Create Appointment') }}
          </a>
          <a href="{{ url_for('appointments.appointment_list') }}"
             class="block px-4 py-2 hover:bg-gray-100">
            {{ _('View Appointments') }}
          </a>
        </div>
      </div>

      <!-- Settings -->
      <div class="relative group">
        <i class="fas fa-cog"></i>
        <a href="{{ url_for('companies.company_detail') }}" class="hover:underline uppercase">{{ _('Settings') }}</a>
        <div class="dropdown-menu">
          <a href="{{ url_for('companies.company_detail') }}"
             class="block px-4 py-2 hover:bg-gray-100">
            {{ _('Company Settings') }}
          </a>
          <a href="{{ url_for('packages.packages_list') }}"
             class="block px-4 py-2 hover:bg-gray-100">
            {{ _('Expertise Packages') }}
          </a>
          <a href="{{ url_for('customers.customer_list') }}"
             class="block px-4 py-2 hover:bg-gray-100">
            {{ _('Customers') }}
          </a>
          <a href="{{ url_for('staff.staff_list') }}"
             class="block px-4 py-2 hover:bg-gray-100">
            {{ _('Staff Management') }}
          </a>
        </div>
      </div>



    </div>
  </div>
</div>

<style>
  .dropdown-menu {
    visibility: hidden;
    opacity: 0;
    position: absolute;
    left: 0;
    margin-top: 0.5rem;
    background-color: white;
    border: none;
    border-radius: 0.5rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    z-index: 1000;
    transition: visibility 0.2s, opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
    transform: translateY(-10px);
    min-width: 200px;
    overflow: hidden;
  }
  .relative.group:hover .dropdown-menu {
    transform: translateY(0);
  }
  .relative.group:hover .dropdown-menu {
    visibility: visible;
    opacity: 1;
    display: block !important;
  }
  .dropdown-menu a {
    display: block;
    padding: 10px 16px;
    color: #333;
    text-decoration: none;
    pointer-events: auto !important;
    border-bottom: 1px solid #eaeaea;
    transition: all 0.2s ease;
  }
  .dropdown-menu a:last-child {
    border-bottom: none;
  }
  .dropdown-menu a:hover {
    background-color: #f8f9fa;
    padding-left: 20px;
  }
</style>

<!-- Logout Confirmation Modal -->
<div id="logoutModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex justify-center items-center hidden z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96">
    <h3 class="text-lg font-bold mb-4">{{ _('Confirm Logout') }}</h3>
    <p class="mb-6">{{ _('Are you sure you want to log out?') }}</p>
    <div class="flex justify-end space-x-4">
      <button id="cancelLogout" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded">{{ _('Cancel') }}</button>
      <a href="{{ url_for('auth.logout') }}" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">{{ _('Logout') }}</a>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/navbar.js') }}"></script>
<script src="{{ url_for('static', filename='js/dropdown-fix.js') }}"></script>
<script src="{{ url_for('static', filename='js/back-button.js') }}"></script>

<script>
  // Logout confirmation modal
  const logoutBtn = document.getElementById('logoutBtn');
  const logoutModal = document.getElementById('logoutModal');
  const cancelLogout = document.getElementById('cancelLogout');

  if (logoutBtn) {
    logoutBtn.addEventListener('click', function(e) {
      e.preventDefault();
      logoutModal.classList.remove('hidden');
    });
  }

  if (cancelLogout) {
    cancelLogout.addEventListener('click', function() {
      logoutModal.classList.add('hidden');
    });
  }

  // Close modal when clicking outside
  window.addEventListener('click', function(event) {
    if (event.target === logoutModal) {
      logoutModal.classList.add('hidden');
    }
  });
</script>
