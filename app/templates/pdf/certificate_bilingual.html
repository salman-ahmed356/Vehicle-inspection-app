<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vehicle Inspection Certificate - شهادة فحص المركبة</title>
  <style>
    @page {
      size: A4;
      margin: 70px 15mm 150px 15mm;
      @top-center {
        content: element(header);
      }
      @bottom-center {
        content: element(footer);
      }
    }
    
    .page-header {
      position: running(header);
      border-bottom: 2px solid #000;
      padding: 8px 0;
      margin-bottom: 10px;
    }
    
    .page-footer {
      position: running(footer);
      border-top: 2px solid #000;
      padding: 8px 0;
      font-size: 7pt;
      margin-top: 10px;
      margin-bottom: 15px;
    }
    
    .terms-title {
      font-weight: bold;
      font-size: 9pt;
      text-decoration: underline;
      margin-bottom: 4px;
    }
    
    .company-contact {
      text-align: center;
      font-size: 7pt;
      margin-top: 6px;
      font-weight: bold;
    }
    
    body {
      font-family: 'DejaVu Sans', 'Arial Unicode MS', Arial, sans-serif;
      font-size: 9pt;
      line-height: 1.2;
      margin: 0;
      padding: 0;
      color: #333;
    }
    
    .arabic {
      font-family: 'DejaVu Sans', 'Arial Unicode MS', 'Tahoma', Arial, sans-serif;
      direction: rtl;
      text-align: right;
      font-size: 12pt;
      color: #555;
      margin-top: 1px;
      unicode-bidi: bidi-override;
    }
    
    .certificate-content {
      margin-top: 10px;
      border: 1px solid #ddd;
      padding: 10px;
    }
    
    .english-side {
      width: 50%;
      padding-right: 15px;
      float: left;
    }
    
    .arabic-side {
      width: 50%;
      padding-left: 15px;
      direction: rtl;
      text-align: right;
      float: right;
    }
    
    .clearfix::after {
      content: "";
      display: table;
      clear: both;
    }
    
    .expertise-item {
      margin-bottom: 6px;
      padding: 4px;
      min-height: 40px;
      display: table-cell;
      vertical-align: top;
    }
    
    .expertise-title {
      font-weight: bold;
      font-size: 10pt;
      margin-bottom: 3px;
      color: #000;
    }
    
    .arabic-title {
      font-weight: bold;
      font-size: 12pt;
      margin-bottom: 3px;
      color: #000;
    }
    
    .expertise-status {
      font-weight: normal !important;
      margin-bottom: 3px;
      font-size: 9pt;
      color: #000;
    }
    
    .arabic-status {
      font-weight: normal !important;
      margin-bottom: 3px;
      font-size: 11pt;
      color: #000;
    }
    
    .expertise-comment {
      font-size: 8pt;
      color: #000;
      margin-top: 3px;
      white-space: pre-line;
      font-weight: normal !important;
    }
    
    .arabic-comment {
      font-size: 10pt;
      color: #000;
      margin-top: 3px;
      white-space: pre-line;
      direction: rtl;
      text-align: right;
      word-wrap: break-word;
      overflow-wrap: break-word;
      unicode-bidi: embed;
      line-height: 1.4;
      word-break: break-word;
      font-weight: normal !important;
    }
    
    /* Only titles should be bold */
    .arabic-title {
      font-weight: bold !important;
    }
    
    .expertise-title {
      font-weight: bold !important;
    }
    
    /* Status and comments should be normal weight */
    .arabic-status {
      font-weight: normal !important;
    }
    
    .arabic-comment {
      font-weight: normal !important;
    }
    
    .section-header {
      font-size: 12pt;
      font-weight: bold;
      text-align: center;
      margin-bottom: 15px;
      padding: 8px;
      color: #000;
    }
  </style>
</head>
<body>
  <!-- Page Header (appears on every page) -->
  <div class="page-header">
    <table style="width: 100%; border-collapse: collapse;">
      <tr>
        <td style="width: 25%; vertical-align: middle; text-align: left;">
          {% if car_image_base64 %}
          <img src="data:image/jpeg;base64,{{ car_image_base64 }}" alt="Vehicle Image" style="height: 35px; width: 70px; object-fit: cover; border-radius: 3px;">
          {% endif %}
        </td>
        <td style="width: 50%; vertical-align: middle; text-align: center;">
          <div style="font-size: 16pt; font-weight: bold; color: #dc2626; text-transform: uppercase;">{{ company.name }}</div>
        </td>
        <td style="width: 25%; vertical-align: middle; text-align: right; font-size: 8pt; color: #666;">
          Professional Vehicle Testing Services<br>
          <strong>VEHICLE INSPECTION CERTIFICATE</strong>
        </td>
      </tr>
    </table>
  </div>
  
  <!-- Page Footer (appears on every page) -->
  <div class="page-footer">
    <div style="border: 1px solid #ddd; padding: 8px; margin-top: 10px; margin-bottom: 10px;">
      <table style="width: 100%; border-collapse: collapse;">
        <tr>
          <td style="width: 50%; vertical-align: top; padding-right: 15px;">
            <div class="terms-title">Terms & Conditions</div>
            <div>This certificate shows the test values at time of inspection only. {{ company.name }} is not responsible for any hidden defects and inspection done according to the traffic law. Validity of this certificate is for the same day only.</div>
          </td>
          <td style="width: 50%; vertical-align: top; padding-left: 15px; direction: rtl; text-align: right; font-size: 9pt;">
            <div class="terms-title">الشروط والأحكام</div>
            <div>تُظهر هذه الشهادة قيم الاختبار في وقت الفحص فقط. {{ company.name }} غير مسؤولة عن أي عيوب خفية والفحص تم وفقاً لقانون المرور. صلاحية هذه الشهادة لنفس اليوم فقط.</div>
          </td>
        </tr>
      </table>
      <div class="company-contact">
        Tel: {{ company.phone if company.phone else 'N/A' }} | Email: {{ company.email if company.email else 'N/A' }}{% if company.address %} | {{ company.address.street_address if company.address.street_address else '' }}{{ ', ' + company.address.city if company.address.city else '' }}{% endif %}
      </div>
    </div>
  </div>
  
  <!-- Vehicle Information Box (same as existing PDFs) -->
  <div style="display: flex; margin-bottom: 10px; font-size: 10pt; border: 2px solid #000; padding: 10px;">
    <div style="width: 50%; padding-right: 10px;">
      <div style="margin-bottom: 5px;"><strong>Ref #:</strong> {{ report.id }}</div>
      <div style="margin-bottom: 5px;"><strong>Customer:</strong> {{ customer.full_name if customer else 'N/A' }}</div>
      <div style="margin-bottom: 5px;"><strong>Vehicle:</strong> {{ vehicle.brand }} {{ vehicle.model if vehicle else 'N/A' }}</div>
      <div style="margin-bottom: 5px;"><strong>Color:</strong> {{ vehicle.color.value if vehicle and vehicle.color else 'N/A' }}</div>
      <div style="margin-bottom: 5px;"><strong>Inspector:</strong> {{ staff.full_name if staff else 'Administrator' }}</div>
    </div>
    <div style="width: 50%; padding-left: 10px;">
      <div style="margin-bottom: 5px;"><strong>Date:</strong> {{ report.created_at.strftime('%d-%b-%Y %I:%M %p') if report.created_at else 'N/A' }}</div>
      <div style="margin-bottom: 5px;"><strong>VIN #:</strong> {{ vehicle.chassis_number if vehicle else 'N/A' }}</div>
      <div style="margin-bottom: 5px;"><strong>Model:</strong> {{ vehicle.model_year if vehicle else 'N/A' }}</div>
      <div style="margin-bottom: 5px;"><strong>Mileage:</strong> {{ vehicle.mileage if vehicle else 'N/A' }}</div>
      <div style="margin-bottom: 5px;"><strong>Phone:</strong> {{ customer.phone_number if customer else 'N/A' }}</div>
    </div>
  </div>

  <!-- Certificate Content - Bilingual Layout -->
  <div class="certificate-content">
    <table style="width: 100%; border-collapse: collapse;">
      <tr>
        <td style="width: 50%; vertical-align: top; padding-right: 15px;">
          <div class="section-header">Additional to Body</div>
        </td>
        <td style="width: 50%; vertical-align: top; padding-left: 15px; direction: rtl; text-align: right; font-size: 15pt;">
          <div class="section-header">إضافات الهيكل</div>
        </td>
      </tr>
      {% for pckg_report in package_expertise_reports %}
        {% set has_comment = pckg_report.comment and pckg_report.comment|string|trim and pckg_report.comment|string|trim|lower not in ['none', 'null', ''] %}
        {% set has_arabic_comment = pckg_report.comment_arabic and pckg_report.comment_arabic|string|trim and pckg_report.comment_arabic|string|trim|lower not in ['none', 'null', ''] %}
        {% if pckg_report.pass_fail or has_comment or has_arabic_comment %}
          {% set expertise_name = pckg_report.expertise_type_name|replace(' Expertise', '') %}
          <tr>
            <td style="width: 50%; vertical-align: top; padding-right: 15px; padding-bottom: 8px;">
              <div class="expertise-title">{{ expertise_name|upper }}</div>
              {% if pckg_report.pass_fail %}
                <div class="expertise-status">{{ pckg_report.pass_fail|upper }}</div>
              {% endif %}
              {% if has_comment %}
                <div class="expertise-comment">
                  {% if pckg_report.comment_english and pckg_report.comment_english != pckg_report.comment %}
                    <!-- Arabic input: show English translation -->
                    {{ pckg_report.comment_english }}
                  {% else %}
                    <!-- English input: show original English -->
                    {{ pckg_report.comment }}
                  {% endif %}
                </div>
              {% endif %}
            </td>
            <td style="width: 50%; vertical-align: top; padding-left: 15px; padding-bottom: 8px; direction: rtl; text-align: right; font-size: 13pt;">
              <div class="arabic-title">{{ pckg_report.arabic_name }}</div>
              {% if pckg_report.pass_fail %}
                <div class="arabic-status">
                  {% if pckg_report.pass_fail == 'Pass' %}
                    ناجح
                  {% elif pckg_report.pass_fail == 'Fail' %}
                    فشل
                  {% endif %}
                </div>
              {% endif %}
              {% if has_comment or has_arabic_comment %}
                <div class="arabic-comment">
                  {% if pckg_report.comment_english and pckg_report.comment_english != pckg_report.comment %}
                    <!-- Arabic input: show original Arabic -->
                    {{ pckg_report.comment|replace('\n', '<br>')|safe }}
                  {% else %}
                    <!-- English input: show Arabic translation -->
                    {{ pckg_report.comment_arabic|replace('\n', '<br>')|safe }}
                  {% endif %}
                </div>
              {% endif %}
            </td>
          </tr>
        {% endif %}
      {% endfor %}
    </table>
  </div>

</body>
</html>